# Enable bzlmod (default in Bazel 8)
common --enable_bzlmod
common --registry=https://bcr.bazel.build

# Output base configuration - ensures consistent location
startup --output_base=/home/protolake/.cache/bazel

# Output directory configuration
build --symlink_prefix=.bazel/
test --symlink_prefix=.bazel/

# Build options
build --jobs=4
build --keep_going
build --verbose_failures

# Java options - use default Java toolchain from rules_java
build --java_language_version=21
build --tool_java_language_version=21
build --java_runtime_version=local_jdk
build --tool_java_runtime_version=local_jdk

# Proto options
build --protocopt=--experimental_allow_proto3_optional

# Output options
build --show_timestamps
build --show_progress_rate_limit=5

# Platform configuration
build --incompatible_enable_cc_toolchain_resolution
build --incompatible_strict_action_env

# Publish genrules need filesystem access for local install
build --strategy=Genrule=local

# Proto compilation with protoc-gen-es needs host filesystem access
# (protoc-gen-es is globally installed, not hermetically managed by Bazel)
build --strategy=ProtoCompile=local
build --action_env=PATH

# Pass publishing env vars through to Bazel actions
build --action_env=HOME
build --action_env=MAVEN_REPO
build --action_env=PYPI_REPO
build --action_env=VERSION
build --action_env=NPM_PUBLISH_MODE
build --action_env=REGISTRY_TOKEN
build --action_env=NPM_REGISTRY_URL
build --action_env=NPM_REGISTRY_TOKEN
build --action_env=JS_TARGETS

# Disk cache for build artifacts
build --disk_cache=/home/protolake/.cache/bazel-disk-cache

# Optional: convenience symlinks
build --experimental_convenience_symlinks=normal

# Remote cache configuration (generated from lake.yaml remote_cache settings)
# Activate with: --config=ci (or set PROTOLAKE_BAZEL_CONFIG=ci)
try-import %workspace%/.bazelrc.remote-cache